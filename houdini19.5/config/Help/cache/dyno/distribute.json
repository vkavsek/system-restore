{"type": "root", "attrs": {}, "body": [{"level": 0, "type": "title", "indent": 0, "text": ["Distributing simulations"], "extent": [0, 29]}, {"type": "summary", "indent": 0, "text": ["Distribute shelf tools set up an object\u2019s sim network so it can be solved in parallel on a farm of multiple machines using HQueue."], "extent": [29, 169]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Overview"], "extent": [169, 184], "body": [{"type": "para", "indent": 0, "text": ["The ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim"}, " ", {"type": "ui", "text": ["Distribute Particle Fluid"]}, " shelf tool allows you to set up the networks of a simulated object so that it can be solved in parallel on multiple machines using HQueue. "], "extent": [184, 394]}, {"type": "para", "indent": 0, "text": ["You can distribute particle fluids and single grid-based fluid containers using ", {"type": "em", "text": ["slicing"]}, ", where the space in which the effect happens is partitioned and each slice is solved on a separate machine. You can slice grid-based fluid containers using a certain number of divisions per side, but for particle fluids simulations that ", {"type": "em", "text": ["do not"]}, " have boundaries, you have to ", {"scheme": null, "value": "#slicing", "type": "link", "text": ["slice them manually"], "fullpath": "/dyno/distribute#slicing", "fragment": "#slicing"}, "."], "extent": [394, 792]}, {"type": "para", "indent": 0, "text": ["For sliced simulations, the nodes on the network talk to each other to communicate information across the boundaries between slices."], "extent": [792, 926]}, {"type": "para", "indent": 0, "text": ["For clustered fluid simulations, each cluster container solves independently, even if they overlap with other cluster containers. For smoke and pyro simulations this works well since their output volumes blend together visually."], "extent": [926, 1156]}, {"type": "platform_group", "body": [{"ext": null, "type": "platform", "indent": 0, "text": [" Mac"], "role": "item", "extent": [1156, 1171], "body": [{"type": "para", "indent": 4, "text": ["Distributed simulations are supported only on macOS 10.14.4 and above."], "extent": [1171, 1247]}], "container": true}], "container": true, "role": "item_group"}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Methods of distributing simulations"], "extent": [1247, 1289], "body": [{"type": "para", "indent": 0, "text": ["You can select the distribution method you want to use from the ", {"type": "ui", "text": ["Partitioning Type"]}, " drop-down menu located in the ", {"type": "code", "text": ["distributedsim"]}, " ", {"scheme": null, "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation render node"], "fullpath": "/nodes/out/hq_sim"}, " parameters."], "extent": [1289, 1486]}, {"type": "dt_group", "body": [{"type": "dt", "indent": 0, "text": ["No partitioning"], "extent": [1486, 1503], "body": [{"type": "para", "indent": 3, "text": ["Sends the entire simulation to another machine to be simulated as a whole. For cloth and wire simulations this works well as they ", {"type": "em", "text": ["cannot"]}, " be sliced."], "extent": [1503, 1657]}], "container": true}, {"type": "dt", "indent": 0, "text": ["Clustering"], "extent": [1657, 1669], "body": [{"type": "para", "indent": 3, "text": ["Allows you to partition the source into chunks along the X, Y, or Z axis. These pieces are simulated simultaneously, but they ", {"type": "em", "text": ["do not"]}, " talk to each other or transfer particles between frames. Since clustering doesn\u2019t need to wait for each partition to finish simulating a frame before moving onto the next, this method is much faster than slicing. "], "extent": [1669, 2034]}], "container": true}, {"type": "dt", "indent": 0, "text": ["Slicing"], "extent": [2034, 2043], "body": [{"type": "para", "indent": 3, "text": ["Allows you to slice the space containing a particle fluid so that different machines on an HQueue farm can simulate different parts of the fluid. Since this method transfers particles between slices at the end of each frame, it is more precise (but also more ", {"type": "em", "text": ["expensive"]}, ") than clustering."], "extent": [2043, 2336]}, {"type": "tip_group", "body": [{"type": "tip", "indent": 3, "role": "item", "extent": [2336, 2344], "body": [{"type": "para", "indent": 5, "text": ["For more control over the direction and hierarchy of your pieces, use the ", {"scheme": "Icon", "value": "DOP/sliceplane", "type": "link", "text": "", "fullpath": "/dyno/DOP/sliceplane"}, " ", {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice"}, " or ", {"scheme": "Icon", "value": "DOP/slicealongline", "type": "link", "text": "", "fullpath": "/dyno/DOP/slicealongline"}, " ", {"scheme": null, "value": "/shelf/slicealongline", "type": "link", "text": ["Slice Along Line"], "fullpath": "/shelf/slicealongline"}, " shelf tool."], "extent": [2344, 2549]}, {"type": "para", "indent": 5, "text": ["For more information, see ", {"scheme": null, "value": "#slicing", "type": "link", "text": ["Set up a sliced distributed simulation"], "fullpath": "/dyno/distribute#slicing", "fragment": "#slicing"}, "."], "extent": [2549, 2632]}], "container": true}], "container": true, "role": "item_group"}, {"type": "dt_group", "body": [{"type": "dt", "indent": 3, "text": ["Volume slicing"], "extent": [2632, 2651], "body": [{"type": "para", "indent": 5, "text": ["Automatically slices a space containing a particle fluid into equal NxMxP pieces. You can also specify a specific overlap to provide a buffer around each piece. The separate machines will then work on each slice, and periodically synchronize their buffers. This works well for ", {"type": "em", "text": ["dense"]}, " sims in fixed rectangular spaces like pyro solves. "], "extent": [2651, 2994]}], "container": true}, {"type": "dt", "indent": 3, "text": ["Particle slicing"], "extent": [2994, 3015], "body": [{"type": "para", "indent": 5, "text": ["For ", {"type": "em", "text": ["non-dense"]}, " simulations, splitting the domain into equal parts doesn\u2019t make sense. It is important that the partition be balanced so that one machine isn\u2019t waiting for the other machines to finish. So instead you will want to divide your sim space using the ", {"type": "strong", "text": ["Slice"]}, " or ", {"type": "strong", "text": ["Slice Plane"]}, " DOP nodes. These divide the world into different regions that each simulation machine then ", {"type": "em", "text": ["owns"]}, ". Each machine has all the data for its own slice and some boundary information for the surrounding slices to avoid having to constantly update."], "extent": [3015, 3550]}], "container": true}], "container": true}], "container": true}, {"type": "dt", "indent": 0, "text": ["Wedging"], "extent": [3550, 3559], "body": [{"type": "para", "indent": 3, "text": ["Allows you to try different variations of a simulation. For more information, see the ", {"scheme": "Icon", "value": "SHELF/factory.svg", "type": "link", "text": "", "fullpath": "/dyno/SHELF/factory.svg"}, " ", {"scheme": null, "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation render node"], "fullpath": "/nodes/out/hq_sim"}, " and ", {"scheme": "Icon", "value": "ROP/wedge.svg", "type": "link", "text": "", "fullpath": "/dyno/ROP/wedge.svg"}, " ", {"scheme": null, "value": "/nodes/out/wedge", "type": "link", "text": ["Wedge render node"], "fullpath": "/nodes/out/wedge"}, "."], "extent": [3559, 3788]}], "container": true}], "container": true}, {"level": 3, "id": "distcompat", "container": true, "type": "h", "indent": 0, "text": ["Distribution method compatibility"], "extent": [3788, 3843], "body": [{"tag": "table", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "th", "attrs": {}, "type": "xml", "text": ["Solver Type"]}, "\n", {"tag": "th", "attrs": {}, "type": "xml", "text": ["Clustering"]}, "\n", {"tag": "th", "attrs": {}, "type": "xml", "text": ["Volume Slicing"]}, "\n", {"tag": "th", "attrs": {}, "type": "xml", "text": ["Particle Slicing"]}, "\n", {"tag": "th", "attrs": {}, "type": "xml", "text": ["Conditions & Restrictions"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["Pyro"]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["For volume slicing:\n", {"tag": "hr", "attrs": {"style": "height:0.0em; visibility:hidden;"}, "type": "xml", "text": ""}, "\n", {"tag": "ul", "attrs": {}, "type": "xml", "text": ["\n   ", {"tag": "li", "attrs": {"style": "line-height: 0.8em;"}, "type": "xml", "text": [{"type": "em", "text": ["Does not"]}, " handle pressure projection very well."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 0.8em;"}, "type": "xml", "text": ["May generate vortex walls at the boundaries between slices."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 0.8em;"}, "type": "xml", "text": ["Scales very poorly."]}, "\n"]}, "\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["Upres/Retime Pyro "]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "ul", "attrs": {}, "type": "xml", "text": ["\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Useful when your machine ", {"type": "em", "text": ["does not"]}, " have enough memory to hold the entire field."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Works well when you correctly ", {"type": "em", "text": ["size"]}, " (velocity x time step) the slice boundaries for your sim."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Cost of synchronization can be high."]}, "\n"]}, "\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["Whitewater"]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {"style": "padding-bottom: 1.5em"}, "type": "xml", "text": ["For particle slicing:", {"tag": "br", "attrs": {}, "type": "xml", "text": ""}, "\n", {"tag": "hr", "attrs": {"style": "height:0.0em; visibility:hidden;"}, "type": "xml", "text": ""}, "\nWhen using the density approximation or clumping operations, please provide sufficient particle overlap at slice exchanges. Otherwise, you may introduce artifacts at the slice exchanges.\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["POP"]}, "  \n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "ul", "attrs": {}, "type": "xml", "text": ["\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Use only if your sim ", {"type": "em", "text": ["does not"]}, " have global computations."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Makes providing unique particle IDs very difficult."]}, "\n"]}, "\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["Grains"]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "ul", "attrs": {}, "type": "xml", "text": ["\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Use only if your sim ", {"type": "em", "text": ["does not"]}, " contain explicit constraints."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Useful for when VRAM is limited and you want to use multiple GPUs or spread memory across multiple GPUs."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Please leave a reasonable amount of overlap to minimize distribution errors."]}, "\n"]}, "\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["FLIP"]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "ul", "attrs": {}, "type": "xml", "text": ["\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["When using the pressure projection operation, please make your sim is distribution-aware. Otherwise, you may introduce artifacts at the slice boundaries."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Viscosity may cause artifacts at slice boundaries since it ", {"type": "em", "text": ["is not"]}, " distribution-aware."]}, "\n"]}, "\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["Narrow Band FLIP"]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-check", "type": "link", "text": null, "fullpath": "/dyno/fa-check"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "ul", "attrs": {}, "type": "xml", "text": ["\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Works only if you synchronize all the fields you are using with your sim."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["Field synchronization ", {"type": "em", "text": ["does not"]}, " support moving slices."]}, "\n   ", {"tag": "li", "attrs": {"style": "line-height: 1.3em;"}, "type": "xml", "text": ["You ", {"type": "em", "text": ["cannot"]}, " use space slicing with slice rebalancing."]}, "\n"]}, "\n"]}, "\n"]}, "\n", {"tag": "tr", "attrs": {}, "type": "xml", "text": ["\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["Adaptive FLIP"]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": [{"scheme": "Glyph", "value": "fa-times", "type": "link", "text": null, "fullpath": "/dyno/fa-times"}]}, "\n", {"tag": "td", "attrs": {}, "type": "xml", "text": ["The pressure projection operation ", {"type": "em", "text": ["does not"]}, " support distribution."]}, "\n"]}, "\n"]}]}]}, {"level": 2, "id": "slicing", "container": true, "type": "h", "indent": 0, "text": ["Set up a sliced distributed simulation"], "extent": [7087, 7142], "body": [{"type": "para", "indent": 0, "text": ["Slicing the space containing a particle fluid allows different machines on the HQueue farm to simulate different ", {"type": "em", "text": ["regions"]}, " of the fluid. You can send a particle fluid simulation to the farm without slicing, but it will just simulate on one machine instead of multiple machines in parallel."], "extent": [7142, 7434]}, {"type": "para", "indent": 0, "text": ["There are two shelf tools on the ", {"type": "ui", "text": ["Particle Fluids"]}, " tab for slicing a particle fluid simulation into separate regions for distribution:"], "extent": [7434, 7572]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Icon", "value": "DOP/slicealongline", "type": "link", "text": "", "fullpath": "/dyno/DOP/slicealongline"}, {"scheme": null, "value": "/shelf/slicealongline", "type": "link", "text": ["Slice along line"], "fullpath": "/shelf/slicealongline"}, " tool"], "extent": [7572, 7646], "body": [{"type": "para", "indent": 3, "text": ["Creates a specified number of equally spaced slices along a certain direction. This is the simplest way to slice up space."], "extent": [7646, 7773]}, {"type": "para", "indent": 3, "text": [{"scheme": "Image", "value": "/images/shelf/slicealongline.jpg", "type": "img", "text": ""}], "extent": [7773, 7818]}], "container": true}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Icon", "value": "DOP/sliceplane", "type": "link", "text": "", "fullpath": "/dyno/DOP/sliceplane"}, {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice"}, " tool"], "extent": [7818, 7868], "body": [{"type": "para", "indent": 3, "text": ["Slices the space using a hierarchy of intersecting planes which arbitrarily divides the space in complex ways."], "extent": [7868, 7983]}, {"type": "para", "indent": 3, "text": [{"scheme": "Image", "value": "/images/shelf/slice.jpg", "type": "img", "text": ""}], "extent": [7983, 8019]}], "container": true}], "container": true}, {"type": "para", "indent": 0, "text": ["Each fluid region requires an individual machine on the HQueue client network, so you can only set up as many regions as you have machines. For example, using the ", {"type": "ui", "text": ["Slice along line"]}, " tool with ", {"type": "ui", "text": ["Number of regions"]}, " set to ", {"type": "code", "text": ["8"]}, " would require 8 machines on the HQueue network."], "extent": [8019, 8295]}, {"level": 3, "id": "slicefluid", "container": true, "type": "h", "indent": 0, "text": ["How to slice a fluid space"], "extent": [8295, 8343], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["On the ", {"type": "ui", "text": ["Particle Fluids"]}, ", ", {"type": "ui", "text": ["Cloth"]}, ", or ", {"type": "ui", "text": ["Wire"]}, " shelf tab, click the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool."], "extent": [8343, 8474]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Select the particle fluid, cloth, or wire object and press ", {"keys": ["Enter"], "type": "keys", "text": null}, "."], "extent": [8474, 8547], "body": [{"type": "para", "indent": 4, "text": ["This creates a few nodes in various networks for distributing the simulation:"], "extent": [8547, 8634]}, {"type": "bullet_group", "body": [{"blevel": 6, "type": "bullet", "indent": 4, "text": ["A ", {"type": "code", "text": ["distributedsim"]}, " HQueue Simulation render node in ", {"type": "code", "text": ["/out"]}, " to render the simulation out to HQueue."], "extent": [8634, 8744], "body": [{"type": "para", "indent": 8, "text": ["This render node sends the distribution job to the HQueue server."], "extent": [8744, 8823]}], "container": true}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["A ", {"type": "code", "text": ["distribute_", {"type": "var", "text": ["objectname"]}]}, " object in ", {"type": "code", "text": ["/obj"]}, " to load the simulation files created by the HQueue clients back into Houdini."], "extent": [8823, 8959]}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["A ", {"type": "code", "text": ["DISTRIBUTE_", {"type": "var", "text": ["objectname"]}, "_CONTROLS"]}, " Null node in the DOP network."], "extent": [8959, 9039], "body": [{"type": "para", "indent": 8, "text": ["This node is mostly a placeholder for values. The render node explicitly sets values on the control ", {"type": "strong", "text": ["Null"]}, " DOP such as the tracker address/port and slice divisions, and then multiple distribution-aware DOPs in the network reference the value on the control ", {"type": "strong", "text": ["Null"]}, "."], "extent": [9039, 9313]}], "container": true}], "container": true}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["If you want to change the default path pattern for saved geometry files (", {"type": "code", "text": ["$HIP/geo/dist_${SLICE}_$F.bgeo.gz"]}, "), go to the Scene level (", {"type": "code", "text": ["/obj"]}, ") and double-click the ", {"type": "code", "text": ["distribute_", {"type": "var", "text": ["objectname"]}]}, " object to go inside. Select the ", {"type": "code", "text": ["loadslices"]}, " File node and change the ", {"type": "ui", "text": ["File"]}, " parameter. See ", {"scheme": null, "value": "/render/expressions", "type": "link", "text": ["using expressions in filenames"], "fullpath": "/render/expressions"}, " for more information."], "extent": [9313, 9676], "body": [{"type": "para", "indent": 4, "text": ["The path should be relative to ", {"type": "code", "text": ["$HIP"]}, "."], "extent": [9676, 9720]}], "container": true}], "container": true}]}, {"level": 3, "id": null, "container": true, "type": "h", "indent": 0, "text": ["How to view a simulation slice without running it on the farm"], "extent": [9720, 9790], "body": [{"type": "para", "indent": 0, "text": ["The ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool modifies the network to ready it for distribution. If you try to play back the simulation after these modifications, the network will only calculate a slice of the whole simulation, and several nodes will generate network traffic trying to talk to HQueue peers."], "extent": [9790, 10112]}, {"type": "para", "indent": 0, "text": ["If you want to check the simulation on a single machine, you can use parameters on the control ", {"type": "strong", "text": ["Null"]}, " DOP created by the ", {"type": "ui", "text": ["Distribute"]}, " tool to temporarily switch the network back to non-distributed operation."], "extent": [10112, 10323]}, {"type": "task_group", "body": [{"ext": null, "type": "task", "indent": 0, "text": ["View a slice without distributing the simulation"], "role": "item", "extent": [10323, 10379], "body": [{"type": "ord_group", "body": [{"blevel": 6, "type": "ord", "indent": 4, "text": ["On the ", {"type": "code", "text": ["DISTRIBUTE_uprespyro_CONTROLS"]}, " ", {"type": "strong", "text": ["Null"]}, " node in the DOP network, turn off the ", {"type": "ui", "text": ["Distribution"]}, " check-box."], "extent": [10379, 10506]}, {"blevel": 6, "type": "ord", "indent": 4, "text": ["Set the ", {"type": "ui", "text": ["Slice"]}, " parameter to the slice you want to view."], "extent": [10506, 10572]}], "container": true}], "container": true}], "container": true, "role": "item_group"}]}, {"level": 3, "id": null, "container": true, "type": "h", "indent": 0, "text": ["How to use particle fluid distribution with FLIP"], "extent": [10572, 10629], "body": [{"type": "para", "indent": 0, "text": ["Using particle distribution with tanks can sometimes lead to a loss of fluid. Turn on the ", {"type": "ui", "text": ["Distributed Pressure Solve"]}, " check-box on the ", {"scheme": "Node", "value": "/nodes/dop/flipsolver", "type": "link", "text": ["FLIP Solver"], "fullpath": "/nodes/dop/flipsolver"}, " to avoid this issue. This will account for pressure in the tank and result in smoother seams between slices. "], "extent": [10629, 10913]}, {"level": 4, "id": "narrowband", "container": true, "type": "h", "indent": 0, "text": ["How to set up a distributed narrow band FLIP tank"], "extent": [10913, 10986], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Create a ", {"scheme": "Icon", "value": "SHELF/flat_tank", "type": "link", "text": "", "fullpath": "/dyno/SHELF/flat_tank"}, " FLIP tank using one of the tools on the ", {"type": "ui", "text": ["Oceans"]}, " shelf. ", {"type": "ui", "text": ["Narrow Band Particles"]}, " should be enabled by default."], "extent": [10986, 11136]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Use the ", {"scheme": "Icon", "value": "DOP/sliceplane", "type": "link", "text": "", "fullpath": "/dyno/DOP/sliceplane"}, {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice"}, " tool on the ", {"type": "ui", "text": ["Particle Fluids"]}, " shelf to slice the particle fluid."], "extent": [11136, 11256]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Use the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool, and choose ", {"type": "ui", "text": ["Slicing"]}, ". This will set up the network so that it can be solved in parallel on multiple machines using HQueue."], "extent": [11256, 11447]}], "container": true}, {"type": "para", "indent": 0, "text": [{"scheme": "Image", "value": "/images/fluid/distributed_nb.jpg", "type": "img", "text": ""}], "extent": [11447, 11490]}]}]}, {"level": 3, "id": "whitewater", "container": true, "type": "h", "indent": 0, "text": ["How to set up a distributed whitewater simulation"], "extent": [11490, 11561], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Create a whitewater simulation using the tools on the ", {"type": "ui", "text": ["Oceans"]}, " shelf."], "extent": [11561, 11637]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Set the whitewater to distribute and click the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim"}, " ", {"type": "ui", "text": ["Distribute Particle Fluid"]}, " tool on the  ", {"type": "ui", "text": ["Particle Fluids"]}, " shelf."], "extent": [11637, 11791]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Choose between ", {"type": "ui", "text": ["No Partitioning"]}, " and ", {"type": "ui", "text": ["Clustering"]}, " as the distribution method from the pop-up dialog box."], "extent": [11791, 11903], "body": [{"type": "note_group", "body": [{"type": "note", "indent": 8, "role": "item", "extent": [11903, 11917], "body": [{"type": "para", "indent": 12, "text": ["If the whitewater is pre-sliced using the ", {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice"}, " or ", {"scheme": null, "value": "/shelf/slicealongline", "type": "link", "text": ["Slice Along Line"], "fullpath": "/shelf/slicealongline"}, " tools, there will also be an option to choose ", {"type": "ui", "text": ["Slicing"]}, "."], "extent": [11917, 12096]}], "container": true}], "container": true, "role": "item_group"}, {"type": "para", "indent": 8, "text": ["Selecting ", {"type": "ui", "text": ["No Partitioning"]}, " allows you to send your entire simulation to another machine. Selecting ", {"type": "ui", "text": ["Clustering"]}, " allows you to divide up your simulation into chunks that will be simulated simultaneously on another machine. Both options will create an ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation"], "fullpath": "/nodes/out/hq_sim"}, " for your distributed simulation."], "extent": [12096, 12437]}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Choosing ", {"type": "ui", "text": ["Clustering"]}, " will set your ", {"type": "ui", "text": ["Partition Type"]}, " to ", {"type": "ui", "text": ["Clusters"]}, " on the ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation"], "fullpath": "/nodes/out/hq_sim"}, " render node. Click the ", {"scheme": "Icon", "value": "BUTTONS/jump", "type": "link", "text": "", "fullpath": "/dyno/BUTTONS/jump"}, " ", {"type": "ui", "text": ["Jump to operator"]}, " button on ", {"type": "ui", "text": ["Cluster Node"]}, " parameter to jump to the ", {"type": "code", "text": ["partition_emission"]}, " Subnetwork. "], "extent": [12437, 12706]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Set your clusters using the ", {"type": "ui", "text": ["Divisions"]}, " parameter. "], "extent": [12706, 12763], "body": [{"type": "note_group", "body": [{"type": "note", "indent": 8, "role": "item", "extent": [12763, 12777], "body": [{"type": "para", "indent": 12, "text": ["You should make your particle fluid divisions parallel with the flow direction because these clusters will be simulated independently and don\u2019t transfer particles between frames that are born in separate clusters. "], "extent": [12777, 13005]}], "container": true}], "container": true, "role": "item_group"}, {"type": "para", "indent": 8, "text": ["In the following example, a ", {"scheme": null, "value": "/shelf/beachtank", "type": "link", "text": ["Beach Tank"], "fullpath": "/shelf/beachtank"}, " is divided along the Z-axis, which coincides with the flow of the waves up the beach."], "extent": [13005, 13158]}, {"type": "para", "indent": 8, "text": [{"scheme": "Image", "value": "/images/dynamics/distribute_cluster.jpg", "type": "img", "text": ""}], "extent": [13158, 13215]}], "container": true}], "container": true}]}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Set up distributed clustered smoke and pyro simulations"], "extent": [13215, 13277], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Create a clustered smoke or pyro simulation from point sources using the ", {"type": "ui", "text": ["Smoke Cluster"]}, " or ", {"type": "ui", "text": ["Pyro Cluster"]}, " tools on the ", {"type": "ui", "text": ["Pyro FX"]}, " shelf tab (see ", {"scheme": null, "value": "/pyro/clustering", "type": "link", "text": ["clustering"], "fullpath": "/pyro/clustering"}, ")."], "extent": [13277, 13464]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["On the ", {"type": "ui", "text": ["Container Tools"]}, " shelf tab, click the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool."], "extent": [13464, 13570]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Select the container you want to distribute and press ", {"keys": ["Enter"], "type": "keys", "text": null}, "."], "extent": [13570, 13638], "body": [{"type": "para", "indent": 4, "text": ["If you are distributing a clustered simulation with multiple containers created by the smoke/pyro cluster tool, you can just select one of them."], "extent": [13638, 13792]}, {"type": "para", "indent": 4, "text": ["(Alternatively you can select the DOP object in the network editor and then press ", {"keys": ["Enter"], "type": "keys", "text": null}, " in the viewport.)"], "extent": [13792, 13907]}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["If the object has multiple containers (for example, it was created using ", {"scheme": null, "value": "/pyro/clustering", "type": "link", "text": ["clustering"], "fullpath": "/pyro/clustering"}, "), a dialog box appears asking if you want to distribute the simulation using ", {"type": "em", "text": ["slices"]}, " or ", {"type": "em", "text": ["clustering"]}, "."], "extent": [13907, 14116], "body": [{"type": "para", "indent": 4, "text": ["(If your simulation is so massive even a single clustered container at a time is too much to run on one machine, you can click ", {"type": "ui", "text": ["Slicing"]}, " to distribute separate slices of each clustered container.)"], "extent": [14116, 14320]}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["If for some reason you have more than one object importing the results of the simulation, a dialog box will ask you which object should be set up for distribution (see ", {"scheme": null, "value": "#clustering_guts", "type": "link", "text": ["how the tool modifies the geometry network"], "fullpath": "/dyno/distribute#clustering_guts", "fragment": "#clustering_guts"}, " below)."], "extent": [14320, 14561]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["The tool will create and select a ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue simulation render node"], "fullpath": "/nodes/out/hq_sim"}, ". Set the node\u2019s ", {"type": "ui", "text": ["HQueue server"]}, " parameter to the name of the HQueue server machine and port name (for example ", {"type": "code", "text": ["hq.company.com:5000"]}, ")."], "extent": [14561, 14782], "body": [{"type": "para", "indent": 4, "text": ["If you are slicing, you can set the ", {"type": "ui", "text": ["Slice Divisions"]}, " parameter. The default ", {"type": "code", "text": ["1, 1, 1"]}, " slices does not actually divide the container into multiple subdomains. Increasing these values to ", {"type": "code", "text": ["2, 2, 2"]}, ", for example, will slice the container into 8 smaller boxes for distribution."], "extent": [14782, 15063]}], "container": true}], "container": true}, {"level": 3, "id": "clustering_guts", "container": true, "type": "h", "indent": 0, "text": ["Distributed clustering behind-the-scenes"], "extent": [15063, 15130], "body": [{"type": "para", "indent": 0, "text": ["In the Geometry object that imports the simulated fields you distributed (for example, ", {"type": "code", "text": ["import_pyro_build"]}, "), the ", {"type": "ui", "text": ["Distribute"]}, " tool adds a ", {"scheme": "Node", "value": "/nodes/sop/dopio", "type": "link", "text": ["DOP I/O node"], "fullpath": "/nodes/sop/dopio"}, " to write the generated cluster fields to disk using a ", {"scheme": "Node", "value": "/nodes/out/geometry", "type": "link", "text": ["ROP Output Driver"], "fullpath": "/nodes/out/geometry"}, " on the farm."], "extent": [15130, 15407]}, {"type": "para", "indent": 0, "text": ["When the HIP file is ", {"scheme": null, "value": "#run", "type": "link", "text": ["run on the farm"], "fullpath": "/dyno/distribute#run", "fragment": "#run"}, " (below), the HQueue render node does the following:"], "extent": [15407, 15504]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["Sets the global ", {"type": "code", "text": ["$CLUSTER"]}, " variable to the cluster number being generated on this machine."], "extent": [15504, 15598]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["On the ", {"type": "strong", "text": ["Cluster Points"]}, " node (pointed to in the HQueue render node\u2019s ", {"type": "ui", "text": ["Cluster Node"]}, " parameter), it sets the  ", {"type": "ui", "text": ["Cluster Filter"]}, " parameter to the ", {"type": "code", "text": ["$CLUSTER"]}, " variable, so the source network will only generate source points for that cluster number."], "extent": [15598, 15849]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["It cooks the ROP Output Driver (pointed to in the HQueue render node\u2019s ", {"type": "ui", "text": ["Output Driver"]}, " parameter) which causes the simulation to cook and writes out the geometry for the current cluster and frame."], "extent": [15849, 16051]}], "container": true}, {"type": "para", "indent": 0, "text": ["The ", {"type": "ui", "text": ["Distribute"]}, " tool also creates a ", {"scheme": "Node", "value": "/nodes/sop/filemerge", "type": "link", "text": ["File Merge node"], "fullpath": "/nodes/sop/filemerge"}, " in the network to import the cluster fields generated on the farm and reintegrate them on your machine. It sets the display and render flags on this node so when you view the HIP file on your machine it uses the cached geometry files."], "extent": [16051, 16363]}, {"type": "note_group", "body": [{"type": "note", "indent": 0, "role": "item", "extent": [16363, 16369], "body": [{"type": "para", "indent": 4, "text": ["The filename pattern for the output geometry files is set on the File Merge node and referenced from the ROP Output Driver, so if you want to change it, change it on the File Merge node. The pattern must incorporate the ", {"type": "code", "text": ["$CLUSTER"]}, " (cluster number being simulated) and ", {"type": "code", "text": ["$F"]}, " (current frame) variables."], "extent": [16369, 16674]}], "container": true}], "container": true, "role": "item_group"}]}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Turn off the live simulation"], "extent": [16674, 16709], "body": [{"type": "para", "indent": 0, "text": ["Once the HQueue network has generated the geometry, you should stop the original simulation network from cooking since you now have the end-result cached."], "extent": [16709, 16866]}, {"type": "para", "indent": 0, "text": ["Do one of the following:"], "extent": [16866, 16892]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["Turn off the visibility of any scene-level objects that require the simulation to cook."], "extent": [16892, 16983]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["Turn off simulation in Houdini: right click (or pressing and holding on) the ", {"scheme": "Icon", "value": "BUTTONS/resimulate", "type": "link", "text": "", "fullpath": "/dyno/BUTTONS/resimulate"}, " simulation menu in the bottom right corner of the main window and turn off ", {"type": "ui", "text": ["Enable simulation"]}, "."], "extent": [16983, 17187]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["Start a fresh new ", {"type": "code", "text": [".hip"]}, " file that simply loads the generated particle fluid geometry files using a ", {"scheme": "Node", "value": "/nodes/sop/file", "type": "link", "text": ["File surface node"], "fullpath": "/nodes/sop/file"}, "."], "extent": [17187, 17325]}], "container": true}]}, {"level": 2, "id": "run", "container": true, "type": "h", "indent": 0, "text": ["Run the distributed simulation on the farm"], "extent": [17325, 17380], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["In the main menu, choose ", {"type": "ui", "text": ["Render \u25b8 Edit render node \u25b8 distributedsim"]}, ". In the parameter editor:"], "extent": [17380, 17482], "body": [{"type": "bullet_group", "body": [{"blevel": 6, "type": "bullet", "indent": 4, "text": ["Set the frame range you want to simulate."], "extent": [17482, 17535]}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["Check the ", {"type": "ui", "text": ["Slice divisions"]}, " parameter. The product of the three components should equal the number of regions in your particle fluid simulation (for example, ", {"type": "code", "text": ["3, 1, 1"]}, " for a simulation with 3 regions)."], "extent": [17535, 17750], "body": [{"type": "para", "indent": 8, "text": ["This number is set automatically when the ", {"type": "ui", "text": ["Distribute"]}, " tool creates the render node. However, if you then go back and change the number of slices (for example, by changing the ", {"type": "ui", "text": ["Number of regions"]}, " parameter on a Slice Along Line node), you need to update this parameter on the render node."], "extent": [17750, 18056]}], "container": true}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["Set the ", {"type": "ui", "text": ["HQ Server"]}, " to the hostname and port of the HQueue server, for example ", {"type": "code", "text": ["render.example.com:5000"]}, "."], "extent": [18056, 18175]}], "container": true}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["In the parameter editor, click ", {"type": "ui", "text": ["Render"]}, " to send the job to HQueue."], "extent": [18175, 18247], "body": [{"type": "para", "indent": 4, "text": ["The render node sends its information to the HQueue server. The HQueue server sends commands to its client machines to load the ", {"type": "code", "text": [".hip"]}, " file and simulate and save a slice of the particle fluid simulation per-frame. The individual client machines save their generated geometry cache files to the shared network directory."], "extent": [18247, 18577]}], "container": true}], "container": true}]}], "title": ["Distributing simulations"], "summary": ["Distribute shelf tools set up an object\u2019s sim network so it can be solved in parallel on a farm of multiple machines using HQueue."]}