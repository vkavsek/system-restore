{"type": "root", "attrs": {"type": "node", "context": "sop", "internal": "clusterpoints", "icon": "SOP/clusterpoints", "tags": "cluster, points", "since": "12.0", "version": null, "namespace": null}, "body": [{"level": 0, "type": "title", "indent": 0, "text": ["Cluster Points"], "extent": [0, 19]}, {"type": "summary", "indent": 0, "text": ["Higher-level node to cluster points based on their positions (or any vector attribute)."], "extent": [133, 228]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Overview"], "extent": [228, 243], "body": [{"type": "para", "indent": 0, "text": ["This is a higher-level node that can output clustered points with a cluster attribute and optionally cluster center points. For the lower-level clustering node this node is based on, see the ", {"scheme": "Node", "value": "/nodes/sop/cluster", "type": "link", "text": ["Cluster node"], "fullpath": "/nodes/sop/cluster"}, "."], "extent": [243, 469]}, {"type": "para", "indent": 0, "text": ["This node creates a ", {"type": "code", "text": ["cluster"]}, " integer attribute on the points which indicates the cluster number the point belongs to (all points in the same cluster will have the same ", {"type": "code", "text": ["cluster"]}, " value)."], "extent": [469, 657]}, {"type": "para", "indent": 0, "text": ["This node uses the ", {"scheme": "Wp", "value": "http://en.wikipedia.org/wiki/K-means", "type": "link", "text": ["K-means clustering algorithm"], "exists": true}, " to group the points."], "extent": [657, 740]}, {"level": 3, "id": "seeding", "container": true, "type": "h", "indent": 0, "text": ["Change the Seed to change the clustering"], "extent": [1078, 1135], "body": [{"type": "para", "indent": 0, "text": ["The K-means clustering algorithm used by this node is sensitive to the randomly chosen initial cluster centers, especially when you create a small number of clusters. For example, if you have geometry divided into two parts that are far from each other, you might end up with all the points of part A in one cluster, and the points of part B divided into many clusters, just because none of the initial centers happened to be near part A."], "extent": [1135, 1576]}, {"type": "para", "indent": 0, "text": [{"scheme": "Image", "value": "/images/nodes/sop/clusterpoints_bad_clusters.jpg", "type": "img", "text": ""}], "extent": [1576, 1634]}, {"type": "para", "indent": 0, "text": ["In this case you can change the ", {"type": "ui", "text": ["Seed"]}, " parameter until you get a better clustering."], "extent": [1634, 1721]}]}, {"level": 3, "id": "threshold", "container": true, "type": "h", "indent": 0, "text": ["Threshold attribute"], "extent": [1721, 1759], "body": [{"type": "para", "indent": 0, "text": ["This node lets you cluster by blending multiple attributes (by increasing the ", {"type": "ui", "text": ["Control attributes"]}, " parameter). Each attribute has a ", {"type": "ui", "text": ["Weight"]}, " parameter controlling its linear contribution to the proximity measurement that controls which cluster each point goes into."], "extent": [1759, 2031]}, {"type": "para", "indent": 0, "text": ["For some attributes, you may find that a linear scale is not what you want. The example that motivated the threshold feature is clustering points by ", {"type": "em", "text": ["impact time"]}, ". For example:"], "extent": [2031, 2209]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["You use an ", {"scheme": "Node", "value": "/nodes/dop/impactanalysis", "type": "link", "text": ["Impact Analysis DOP"], "fullpath": "/nodes/dop/impactanalysis"}, " to create points where RBD objects hit the ground, in order to create dust clouds. The impact points have an ", {"type": "code", "text": ["impacttime"]}, " attribute containing a time stamp of when the impact occurred."], "extent": [2209, 2454]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["You want to cluster the impact points to put them in separate fluid simulation boxes."], "extent": [2454, 2543]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["You want to sort by location (so points close to each other are in the same box), but also by ", {"type": "em", "text": ["impact time"]}, " (so impact points that occur far apart from each other in time are in separate boxes, even if they occur at the same place)."], "extent": [2543, 2779]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["You could use two ", {"type": "q", "text": ["control attributes"]}, ", position (", {"type": "code", "text": ["P"]}, ") and ", {"type": "code", "text": ["impacttime"]}, ", to control clustering, with a higher ", {"type": "ui", "text": ["Weight"]}, " value for ", {"type": "code", "text": ["impacttime"]}, " to group the points by impact time, then by position."], "extent": [2779, 2980]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["However, the linear nature of the ", {"type": "ui", "text": ["Weight"]}, " parameter may make it difficult to pick the right weight value to get the behavior you want, where impacts that are ", {"type": "q", "text": ["close enough"]}, " in time go into the same box, but otherwise are clustered separately."], "extent": [2980, 3229]}], "container": true}, {"type": "para", "indent": 0, "text": ["This is what the threshold feature is useful for. Instead of a linear weight, it adds a high ", {"type": "q", "text": ["penalty"]}, " to the final distance calculation if the distance of a certain attribute is more than a certain amount (the ", {"type": "em", "text": ["threshold"]}, ")."], "extent": [3229, 3455]}, {"type": "para", "indent": 0, "text": [{"scheme": "Image", "value": "/images/nodes/cluster_threshold.png", "type": "img", "text": ""}], "extent": [3455, 3500]}, {"type": "para", "indent": 0, "text": ["In this example, the red points represent early impacts, and the green points represent later impacts. You can see that in some places points impacts that overlap in position are sorted into different boxes based on different impact times."], "extent": [3500, 3741]}, {"type": "para", "indent": 0, "text": [{"scheme": "Image", "value": "/images/cluster_impact.png", "type": "img", "text": ""}], "extent": [3741, 3777]}]}]}, {"level": 1, "id": "inputs", "container": true, "type": "inputs_section", "indent": 0, "role": "section", "extent": [796, 804], "body": [{"type": "dt_group", "body": [{"type": "dt", "indent": 0, "text": ["Points to cluster"], "extent": [804, 824], "body": [{"type": "para", "indent": 4, "text": ["The input points to sort into clusters. This node will create an attribute (by default called ", {"type": "code", "text": ["cluster"]}, ") on each point containing the cluster number the point belongs to."], "extent": [824, 1004]}], "container": true}, {"type": "dt", "indent": 0, "text": ["Rest Position"], "extent": [1004, 1019], "body": [{"type": "para", "indent": 4, "text": ["Calculate the cluster centers based on the points in this input instead of the points to cluster. This is useful for calculating the cluster centers from a decimated point cloud (for performance) or from the point positions at a different frame (using the ", {"scheme": "Node", "value": "/nodes/sop/timeshift", "type": "link", "text": ["Timeshift node"], "fullpath": "/nodes/sop/timeshift"}, ")."], "extent": [1019, 1318]}], "container": true}], "container": true}], "text": "Inputs"}, {"level": 1, "id": "parameters", "container": true, "type": "parameters_section", "indent": 0, "role": "section", "extent": [1318, 1330], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Output Attribute"], "extent": [1330, 1349], "body": [{"type": "para", "indent": 4, "text": ["The name of the attribute to set on the points. This attribute will contain the cluster number the point belongs to. The default is ", {"type": "code", "text": ["cluster"]}, "."], "extent": [4430, 4578]}], "container": true, "attrs": {"id": "attrib_name"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Output"], "extent": [1416, 1424], "body": [{"type": "para", "indent": 4, "text": ["Whether to output clustered points, cluster centers with ", {"type": "code", "text": ["scale"]}, " attribute, both clustered points and cluster centers in groups, or the bounding boxes of the clusters."], "extent": [1424, 1601]}, {"type": "dt_group", "body": [{"type": "dt", "indent": 4, "text": ["Cluster points"], "extent": [1601, 1621], "body": [{"type": "para", "indent": 8, "text": ["Output the input points with a cluster attribute on each point containing the cluster number the point belongs to."], "extent": [1621, 1749]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Average points"], "extent": [1749, 1769], "body": [{"type": "para", "indent": 8, "text": ["Output the cluster centers as points. The points have a ", {"type": "code", "text": ["scale"]}, " vector attribute describing the bounding box of the points in the cluster."], "extent": [1769, 1921]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Both"], "extent": [1921, 1931], "body": [{"type": "para", "indent": 8, "text": ["Outputs both the clustered input points (in a group named ", {"type": "code", "text": ["clusterpoints"]}, ") and the cluster center points (in a group named ", {"type": "code", "text": ["averagepoints"]}, ")."], "extent": [1931, 2085]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Boxes"], "extent": [2085, 2096], "body": [{"type": "para", "indent": 8, "text": ["Outputs bounding boxes for the clusters."], "extent": [2096, 2146]}], "container": true}], "container": true}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Color Output"], "extent": [2146, 2160], "body": [{"type": "para", "indent": 4, "text": ["Add random color (", {"type": "code", "text": ["Cd"]}, ") attributes to cluster of points."], "extent": [2160, 2222]}, {"type": "dt_group", "body": [{"type": "dt", "indent": 4, "text": ["Points"], "extent": [2222, 2234], "body": [{"type": "para", "indent": 8, "text": ["Do not color the points."], "extent": [2234, 2267]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Colored Particles"], "extent": [2267, 2290], "body": [{"type": "para", "indent": 8, "text": ["Color the points by cluster and create a particle system out of them.\n        This option is for backwards compatibility with versions where\n        points were only displayed when in particle systems."], "extent": [2290, 2500]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Colored Points"], "extent": [2500, 2520], "body": [{"type": "para", "indent": 8, "text": ["Color the points by cluster."], "extent": [2520, 2558]}], "container": true}], "container": true}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Cluster Filter"], "extent": [2558, 2574], "body": [{"type": "para", "indent": 4, "text": ["Only outputs clusters where the cluster number matches this pattern. For example, setting this to ", {"type": "code", "text": ["3 4"]}, " will only output the points in clusters 3 and 4."], "extent": [2574, 2736]}, {"type": "para", "indent": 4, "text": ["The pattern can use the same ", {"scheme": null, "value": "/model/groups#manual", "type": "link", "text": ["pattern matching syntax"], "fullpath": "/model/groups#manual", "fragment": "#manual"}, " as other surface nodes that let you specify point/primitive numbers. For example, ", {"type": "code", "text": ["3-6"]}, " will output clusters 3, 4, 5, and 6."], "extent": [2736, 2942]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Control Attributes"], "extent": [5169, 5189], "body": [{"type": "para", "indent": 4, "text": ["The number of vector attributes to blend together to determine which points should be grouped together. The default is to use the position attribute (", {"type": "code", "text": ["P"]}, "), so the node will cluster together points that are near each other."], "extent": [5216, 5448]}], "container": true, "attrs": {"id": "num_controls"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Control Attribute"], "extent": [5448, 5467], "body": [{"type": "para", "indent": 4, "text": ["The name of a vector attribute to use to cluster points. Points with close values of this attribute will be grouped together."], "extent": [5496, 5631]}], "container": true, "attrs": {"id": "control_attrib"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Weight"], "extent": [5631, 5639], "body": [{"type": "para", "indent": 4, "text": ["The strength of a particular vector attribute in controlling which points should be grouped together. This is a linear scale. For a more discrete grouping method, use the ", {"scheme": null, "value": "#threshold", "type": "link", "text": ["threshold"], "fullpath": "/nodes/sop/cluster#threshold", "fragment": "#threshold"}, "."], "extent": [5668, 5868]}], "container": true, "attrs": {"id": "control_weight"}, "role": "item"}], "container": true, "role": "item_group"}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Cluster settings"], "extent": [3042, 3065], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Build Clusters"], "extent": [3065, 3082], "body": [{"type": "para", "indent": 4, "text": ["If the incoming geometry already has a point attribute with the specified\n    output name, you can skip cluster building and just use it.  This allows you to take advantage of the other options for setting up cluster simulations."], "extent": [3082, 3317]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Clusters"], "extent": [4280, 4291], "body": [{"type": "para", "indent": 4, "text": ["The number of clusters to group the input points into."], "extent": [4318, 4382]}], "container": true, "attrs": {"id": "num_clusters"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Seed"], "extent": [6272, 6278], "body": [{"type": "para", "indent": 4, "text": ["Changing this will usually generate different groupings and cluster number assignments."], "extent": [6304, 6401]}, {"type": "para", "indent": 4, "text": ["The K-means clustering algorithm starts with random cluster centers and then iterates to refine the cluster centers. Changing the initial positions can potentially change the groups."], "extent": [6401, 6589]}], "container": true, "attrs": {"id": "random_seed"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Refinement iterations"], "extent": [3380, 3403], "body": [{"type": "para", "indent": 4, "text": ["Higher numbers give more accurate clustering but take longer to compute."], "extent": [5905, 5987]}, {"type": "para", "indent": 4, "text": ["The K-means clustering algorithm starts with random cluster centers, assigns points to clusters based on their distance from the centers, then moves to centers based on the points in the cluster and repeats. This iterative process usually converges toward more accurate clusters."], "extent": [5987, 6272]}], "container": true, "attrs": {"id": "iterations"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Threshold Attribute"], "extent": [6589, 6610], "body": [{"type": "para", "indent": 4, "text": ["Use the value of this float or integer attribute as a ", {"scheme": null, "value": "#threshold", "type": "link", "text": ["threshold"], "fullpath": "/nodes/sop/cluster#threshold", "fragment": "#threshold"}, ", where points that aren\u2019t ", {"type": "q", "text": ["close enough"]}, " (within the ", {"type": "ui", "text": ["Goal threshold"]}, ") in this attribute will not be grouped together, even if they are close according to the control attribute."], "extent": [6641, 6903]}], "container": true, "attrs": {"id": "threshold_attrib"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Weight"], "extent": [6903, 6911], "body": [{"type": "para", "indent": 4, "text": ["The strength of the ", {"type": "ui", "text": ["Threshold Attribute"]}, ". Set this to ", {"type": "code", "text": ["0"]}, " to turn off the threshold."], "extent": [6942, 7039]}], "container": true, "attrs": {"id": "threshold_weight"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Initial Threshold"], "extent": [7039, 7058], "body": [{"type": "para", "indent": 4, "text": ["The initial ", {"type": "q", "text": ["cutoff"]}, " value of the threshold attribute, used in the first clustering iteration. The threshold value works better if it\u2019s high at first (so the control attribute dominates) and lowers toward the ", {"type": "ui", "text": ["Goal threshold"]}, " at each iteration. As a rule of thumb, start by setting this to 4 times the ", {"type": "ui", "text": ["Goal threshold"]}, "."], "extent": [7090, 7419]}], "container": true, "attrs": {"id": "initial_threshold"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Goal Threshold"], "extent": [7419, 7435], "body": [{"type": "para", "indent": 4, "text": ["The ", {"type": "q", "text": ["cutoff"]}, " value of the threshold attribute, used in the final clustering iteration. Points with values farther apart than this value will be unlikely to end up in the same cluster."], "extent": [7465, 7654]}], "container": true, "attrs": {"id": "final_threshold"}, "role": "item"}], "container": true, "role": "item_group"}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Averaging settings"], "extent": [3613, 3638], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Copy point attributes from cluster"], "extent": [3638, 3675], "body": [{"type": "para", "indent": 4, "text": ["The average points representing the clusters will have the attributes\n    of the cluster points attribute transferred onto them."], "extent": [3675, 3809]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Max Sample Count"], "extent": [3809, 3827], "body": [{"type": "para", "indent": 4, "text": ["The number of nearest points to contribute to the point attribute\n    of the center.  A value of 1 will just use the closest point."], "extent": [3827, 3964]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Size Attribute name"], "extent": [3964, 3985], "body": [{"type": "para", "indent": 4, "text": ["When ", {"type": "ui", "text": ["Output"]}, " is ", {"type": "q", "text": ["Average points"]}, " or ", {"type": "q", "text": ["Both"]}, ", the node adds a vector attribute with this name to the cluster center points, describing the bounding box of the points in the cluster. The default is ", {"type": "code", "text": ["scale"]}, "."], "extent": [3985, 4197]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Padding min"], "extent": [4197, 4210], "body": [{"type": "para", "indent": 4, "text": ["Amount of padding to add to the negative X, negative Y, and negative Z sides of bounding boxes and/or the ", {"type": "code", "text": ["scale"]}, " attribute on cluster center points."], "extent": [4233, 4388]}], "container": true, "attrs": {"id": "size_padding"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Padding max"], "extent": [4388, 4401], "body": [{"type": "para", "indent": 4, "text": ["Amount of padding to add to the positive X, positive Y, and positive Z sides of bounding boxes and/or the ", {"type": "code", "text": ["scale"]}, " attribute on cluster center points."], "extent": [4429, 4584]}], "container": true, "attrs": {"id": "size_padding2"}, "role": "item"}], "container": true, "role": "item_group"}]}], "text": "Parameters"}, {"level": 1, "id": "related", "container": true, "type": "related_section", "indent": 0, "role": "section", "extent": [4584, 4593], "body": [{"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/sop/cluster", "type": "link", "text": "", "fullpath": "/nodes/sop/cluster"}], "extent": [4593, 4615]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/sop/partition", "type": "link", "text": "", "fullpath": "/nodes/sop/partition"}], "extent": [4615, 4638]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/dop/impactanalysis", "type": "link", "text": "", "fullpath": "/nodes/dop/impactanalysis"}], "extent": [4638, 4666]}], "container": true}], "text": "Related"}], "title": ["Cluster Points"], "summary": ["Higher-level node to cluster points based on their positions (or any vector attribute)."], "included": ["/nodes/sop/cluster"]}